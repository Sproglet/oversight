#!/bin/sh
# Set Paths

d="`echo $0 | sed 's;/[^/]*$;;'`"

OVS_HOME="`cd "$d" ; cd .. ; pwd`"

export PATH="$OVS_HOME/bin:$PATH"

is_nmt100() {
    [ -f /mnt/syb8634/MIN_FIRMWARE_VER ]
}
is_nmt200() {
    [ -f /nmt/apps/MIN_FIRMWARE_VER ] 
}
is_nmt() {
    is_nmt100 || is_nmt200
}

is_dns323() {
    [ -d /ffp/bin ]
}

ARCH=
if is_nmt100 ;then
    ARCH=nmt100
    uid=nmt
    gid=nmt
else
    if is_nmt200 ; then
        ARCH=nmt200
        uid=nmt
        gid=nmt
    else 
        if is_dns323 ; then
            ARCH=dns323
            uid=nobody
            gid=501
            #Odd error where globbing sometimes doesnt work when scripts called from awk
            #eg system("mv blah/*"); 
            #but always works from command line.
            #see if SHELL fixes.
            export SHELL=/ffp/bin/bash
        fi
    fi
fi
export uid gid ARCH
export OVERSIGHT_ID="$uid:$gid"

LD_LIBRARY_PATH="${LD_LIBRARY_PATH:-}"

case "$ARCH" in
    nmt*)
        export PATH="$OVS_HOME/bin/$ARCH:$PATH"
        export LD_LIBRARY_PATH="$OVS_HOME/bin/$ARCH:$LD_LIBRARY_PATH"
        ;;
esac

TMP=/share/Apps/oversight/tmp
if [ ! -d $TMP ] ; then 
    TMP=/tmp
fi

# not included in nmt busybox
# $1=file $2=re for extension
BASENAME() {
    echo "$1" | sed "s:.*/::;s:${2:-}\$::"
}
# not included in nmt busybox
DIRNAME() {
    #Add ./ to any path that doesnt start with / or .  
    #Then find any character folloed by a /[^/]*$(ie ?/filename) and replace with ?
    echo "$1" | sed -r 's|^([^/.])|./\1|;s|(.)/[^/]*$|\1|'
}
