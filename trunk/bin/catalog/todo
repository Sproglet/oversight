#
#acurrently broken
#1. Spec out SEASONID _sid function = lookups how. Where is data stored (in index.db or season.db ?) 
#how do we map thetvdb or tvrage (or others) to seasonid.
# why is there no EPPLOT field anymore, possibly because it was derived from imdbid/season/episode ? revisit all this code

#
#
#  make sure plot file is indexed by
#  - oversight id for movies.
#  - SeriesName/start year/season for tv season
#  - SeriesName/start year/season/ep for episodes.
#
#  add config setting to extract id from url - then add minfo_set_id(domain,extract_id(url),"minfo) to scrape function.
#  add config setting to extract title from title tag
#
#  cast scraping for tv shows when lang != en ?
#  convert rating to a number in index.db and oversight display.
#  add mi_by_date=1 if fetched by date. Somehow pass this flag to oversight. 
#  
#  change IMDBFIRST to only look at first n results - matches further down the page tend to be false.
#
#  office us fails due to missng brackets?
#  fetch_xml_single_child is broken - needs to understand new xml format
#
# Scraping imdb twice -> rewrite initial nfo->imdb->search logic -> add concept of "end_scrape" which is satisfied when
# . plot in desired language
# . poster fetched.
# . fanart fetched.
# . Movie connections 
# . cast
# . title.
#
# Also add domain source , or mi_visisted= list of domain":"lang or  just domain for lang neutral eg motech
#
# check logic for mis-identified tv shows
#
# in desired language
# when setting mi_plot also set mi_plot_lang
# Does TMDB API give cast?
# TODO plot must be weighted be language match

Fix indexing of plots without ttid - use domain:id where possible. but as info is gathered from multiple sources we may need to
use oversight id except for series summaries use - title-year-season or title-season

Fix display of brackets in names

Failover to tvrage did not work for waterloo road 6c8


In cases where the keyword appears twice only take the first occurence.
(may need to make an exception for Actors )

Also check for run-away keywords or add some termination keywords. (per domain)

If a scrape fails due to missing plot then skip entire domain.

in catalog.scrape.awk replace hash_merge with one that only updates empty elements.
Also clear title and plt before setting it. 

test 2 letter domain search.

Use gawk specific match array extensions instead of chop function


Implement
catalog_domain_portrait_url=http://www.comingsoon.it/imgdb/Persone/{ID}.jpg

Check blank
catalog_domain_portrait_url_regex_list=

Implement
catalog_domain_poster_url_regex_list=s/_ico//;s/ico/big/

use gensub instead of chop - eg in tv pattern recognition

Add reverse db -> Actort Name to ovsid for the sites that do not have Actor Ids (including tvdb)


When searching a Movie by filename, a Title/Year scrape can be more accurate than an IMDB scrape especially if either:

1. The web engine summary of the Torrent sites list ids of other movies next to the files OR

2. The movie wad originally posted with the wrong IMDB id, but this wrong ID has propogated to the web,
   in this case deleting the nfo and rescanning does not fix (unless we scan for title and not imdb id)
    Example http://search.yahoo.com/search?ei=UTF-8;eo=UTF-8;p=%22haideaf-cracks%22+imdb
     detected as Fish Tank due to original bad nfo.

Also prioritising Title/Year search will help with moving away from IMDB over dependance

movie search : Title Normalisation bug - see logs FS Merlin 2008

Test Plan

Movies
by usenet filename
by Movie Year
by ttid
by nfo/ttid

TV Show:
By name
by initials
by abbrviation
Selection by aired episode
by epno - eptitle.avi
daily show  - Jey Leno etc.
Show with year seasons - BBC Horizon




