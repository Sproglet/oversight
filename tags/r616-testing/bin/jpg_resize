#!/bin/sh

# $Id:$
#
# Call libjpeb commands to resize a backdrop

OVS_HOME=/share/Apps/oversight

export LD_LIBRARY_PATH="$OVS_HOME/bin:$LD_LIBRARY_PATH"

export PATH="$OVS_HOME/bin:$PATH"


# resize a jpeg to Sd or Hd backdrop
input="$1"
tv_mode="$2"
input_width="$3"

case "$tv_mode" in 
    hd) new_width=${new_width:-1400} ;; #add 1400
    sd) new_width=${new_width:-900} ;; # 800 also 624 or 720!
    *) echo "unknown tv_mode usage $0 file.jpg hd|sd [width]" ; exit 1 ;;
esac

#get real width
old_width=`rdjpgcom -verbose "$input" | awk '/^JPEG image is/ { w=$4 ; sub(/w/,"",w) ; print w ; }'`

output=`echo "$input" | sed "s/\.jpg$/.$tv_mode.jpg/"`

#scale it
echo djpeg -scale $new_width/$old_width "$input to $output"
if [ $new_width == $old_width ] ; then
    ln "$input" "$output"
else
    djpeg -scale $new_width/$old_width "$input" | cjpeg > "$output"
fi
